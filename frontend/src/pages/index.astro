---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';

// 定义数据接口
interface Post {
  id: number;
  slug: string;
  title: string;
  created_at: string;
}

// --- 关键：构建时数据获取 ---
// Astro 会在执行 `npm run build` 时运行这段代码
const response = await fetch('http://localhost:3000/api/posts');
const posts: Post[] = await response.json();
---

<Layout title="首页">
	<h1>最新文章</h1>
    
    {posts.length === 0 ? (
        <p>暂时还没有文章，快去 Admin 后台写一篇吧！</p>
    ) : (
        <ul style="list-style: none; padding: 0;">
            {posts.map((post) => (
                <li style="margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 8px;">
                    <h2 style="margin: 0 0 10px 0;">
                        <a href={`/posts/${post.slug}`}>{post.title}</a>
                    </h2>
                    <small style="color: #666;">发布于: {new Date(post.created_at).toLocaleDateString()}</small>
                </li>
            ))}
        </ul>
    )}
</Layout>